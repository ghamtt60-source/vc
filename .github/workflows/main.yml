name: üñ•Ô∏è Windows RDP

on: 
  workflow_dispatch:
    inputs:
      telegram_chat_id:
        description: 'üì± Telegram Chat ID (B·ªè tr·ªëng n·∫øu kh√¥ng d√πng th√¥ng b√°o)'
        required: false
        default: ''
        type: string
      
      rdp_username:
        description: 'üë§ RDP Username / T√™n ƒëƒÉng nh·∫≠p'
        required: true
        default: 'admin'
        type: string
      
      rdp_password:
        description: 'üîê RDP Password / M·∫≠t kh·∫©u'
        required: true
        default: '123456@win'
        type: string
      
      os_version:
        description: 'üìÄ Select Operating System / Ch·ªçn H·ªá ƒêi·ªÅu H√†nh'
        required: true
        default: 'Windows Server 2025'
        type: choice
        options: 
          - "Windows Server 2025"
          - "Windows Server 2022"
          - "Windows Server 2019"
          - "Windows Server 2012"
          - "Windows 11 Professional"
          - "Windows 10 Professional"
      
      cpu_cores:
        description: '‚ö° CPU Cores / S·ªë nh√¢n CPU (1-4)'
        required: true
        default: '2'
        type: choice
        options:
          - '1'
          - '2'
          - '3'
          - '4'
      
      ram_size:
        description: 'üß† RAM Size / Dung l∆∞·ª£ng RAM (2-8GB)'
        required: true
        default: '4'
        type: choice
        options:
          - '2'
          - '3'
          - '4'
          - '5'
          - '6'
          - '7'
          - '8'
      
      num_machines:
        description: 'üñ•Ô∏è Number of Machines / S·ªë l∆∞·ª£ng m√°y (1-5)'
        required: true
        default: '1'
        type: choice
        options:
          - '1'
          - '2'
          - '3'
          - '4'
          - '5'
      
      language:
        description: 'üåê Language / Ng√¥n ng·ªØ'
        required: true
        default: 'English'
        type: choice
        options:
          - "English"
          - "Ti·∫øng Vi·ªát"

jobs:
  # ==================== PREPARE MATRIX ====================
  prepare:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
    steps:
      - name: Set matrix
        id: set-matrix
        run: |
          NUM="${{ github.event.inputs.num_machines }}"
          MATRIX="["
          for i in $(seq 1 $NUM); do
            if [ $i -gt 1 ]; then MATRIX="${MATRIX},"; fi
            MATRIX="${MATRIX}${i}"
          done
          MATRIX="${MATRIX}]"
          echo "matrix=$MATRIX" >> $GITHUB_OUTPUT

  # ==================== WINDOWS RDP DOCKER ====================
  windows-rdp-docker:
    needs: prepare
    runs-on: ubuntu-latest
    timeout-minutes: 360
    strategy:
      matrix:
        instance: ${{ fromJson(needs.prepare.outputs.matrix) }}
      fail-fast: false
      max-parallel: 5
    
    steps:
      - name: üîß System Initialization / Kh·ªüi t·∫°o h·ªá th·ªëng
        run: |
          sudo apt-get update > /dev/null 2>&1
          
          SELECTED_OS="${{ github.event.inputs.os_version }}"
          INSTANCE="${{ matrix.instance }}"
          RDP_USER="${{ github.event.inputs.rdp_username }}"
          RDP_PASS="${{ github.event.inputs.rdp_password }}"
          CPU_CORES="${{ github.event.inputs.cpu_cores }}"
          RAM_SIZE="${{ github.event.inputs.ram_size }}"
          
          # Determine Windows Version
          if [[ "$SELECTED_OS" == *"2025"* ]]; then
            VERSION="2025"
            OS_NAME="Windows Server 2025"
          elif [[ "$SELECTED_OS" == *"2022"* ]]; then
            VERSION="2022"
            OS_NAME="Windows Server 2022"
          elif [[ "$SELECTED_OS" == *"2019"* ]]; then
            VERSION="2019"
            OS_NAME="Windows Server 2019"
          elif [[ "$SELECTED_OS" == *"2012"* ]]; then
            VERSION="2012"
            OS_NAME="Windows Server 2012"
          elif [[ "$SELECTED_OS" == *"11"* ]]; then
            VERSION="11"
            OS_NAME="Windows 11 Professional"
          elif [[ "$SELECTED_OS" == *"10"* ]]; then
            VERSION="10"
            OS_NAME="Windows 10 Professional"
          fi
          
          # Calculate unique ports for each instance
          RDP_PORT=$((3389 + INSTANCE - 1))
          WEB_PORT=$((8006 + INSTANCE - 1))
          
          # Create Docker Compose Configuration
          cat <<EOF > docker-compose.yml
          version: "3.9"
          services:
            windows:
              image: dockurr/windows
              container_name: windows_rdp_${INSTANCE}
              privileged: true
              environment:
                VERSION: "$VERSION"
                USERNAME: "$RDP_USER"
                PASSWORD: "$RDP_PASS"
                RAM_SIZE: "${RAM_SIZE}G"
                CPU_CORES: "$CPU_CORES"
                DISK_SIZE: "60G"
              devices: [ "/dev/kvm" ]
              ports:
                - "${RDP_PORT}:3389"
                - "${WEB_PORT}:8006"
          EOF
          
          docker compose up -d > /dev/null 2>&1
          
          echo "OS_NAME=$OS_NAME" >> $GITHUB_ENV
          echo "RDP_PORT=$RDP_PORT" >> $GITHUB_ENV
          echo "WEB_PORT=$WEB_PORT" >> $GITHUB_ENV
          echo "RDP_USER=$RDP_USER" >> $GITHUB_ENV
          echo "RDP_PASS=$RDP_PASS" >> $GITHUB_ENV
          echo "CPU_CORES=$CPU_CORES" >> $GITHUB_ENV
          echo "RAM_SIZE=$RAM_SIZE" >> $GITHUB_ENV
          
          # Download Kami Tunnel
          wget -q https://github.com/kami2k1/tunnel/releases/latest/download/kami-tunnel-linux-amd64.tar.gz
          tar -xzf kami-tunnel-linux-amd64.tar.gz > /dev/null 2>&1
          chmod +x kami-tunnel
          
          # Start Kami Tunnel for RDP
          nohup ./kami-tunnel $RDP_PORT > kami_tunnel_rdp.log 2>&1 &
          RDP_PID=$!
          echo "RDP Tunnel PID: $RDP_PID"
          
          sleep 5
          
          # Start Kami Tunnel for Web Viewer
          nohup ./kami-tunnel $WEB_PORT > kami_tunnel_web.log 2>&1 &
          WEB_PID=$!
          echo "Web Tunnel PID: $WEB_PID"

      - name: üåê Connection Information / Th√¥ng tin k·∫øt n·ªëi
        run: |
          LANG="${{ github.event.inputs.language }}"
          INSTANCE="${{ matrix.instance }}"
          
          if [ "$LANG" = "Ti·∫øng Vi·ªát" ]; then
            echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
            echo "üîÑ ƒêang thi·∫øt l·∫≠p k·∫øt n·ªëi ƒë·∫øn $OS_NAME #$INSTANCE..."
            echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
          else
            echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
            echo "üîÑ Establishing connection to $OS_NAME #$INSTANCE..."
            echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
          fi
          echo ""
          
          # Get RDP IP
          if [ "$LANG" = "Ti·∫øng Vi·ªát" ]; then
            echo "‚è≥ ƒêang ch·ªù RDP tunnel (C·ªïng $RDP_PORT)..."
          else
            echo "‚è≥ Waiting for RDP tunnel (Port $RDP_PORT)..."
          fi
          
          RDP_PUBLIC_IP=""
          RDP_RETRY=0
          
          while [ -z "$RDP_PUBLIC_IP" ] && [ $RDP_RETRY -lt 60 ]; do
            if [ -f kami_tunnel.txt ]; then
              RDP_CONTENT=$(cat kami_tunnel.txt 2>/dev/null | head -1)
              if [[ "$RDP_CONTENT" =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+:[0-9]+$ ]]; then
                RDP_PUBLIC_IP="$RDP_CONTENT"
                if [ "$LANG" = "Ti·∫øng Vi·ªát" ]; then
                  echo "‚úÖ ƒê√£ l·∫•y IP c√¥ng khai RDP: $RDP_PUBLIC_IP"
                else
                  echo "‚úÖ RDP Public IP captured: $RDP_PUBLIC_IP"
                fi
                break
              fi
            fi
            sleep 3
            RDP_RETRY=$((RDP_RETRY + 1))
          done
          
          if [ -z "$RDP_PUBLIC_IP" ]; then
            if [ "$LANG" = "Ti·∫øng Vi·ªát" ]; then
              echo "‚ùå L·ªñI: Kh√¥ng th·ªÉ l·∫•y IP c√¥ng khai RDP"
            else
              echo "‚ùå ERROR: Could not retrieve RDP Public IP"
            fi
            exit 1
          fi
          
          # Get Web Viewer IP
          if [ "$LANG" = "Ti·∫øng Vi·ªát" ]; then
            echo "‚è≥ ƒêang ch·ªù Web tunnel (C·ªïng $WEB_PORT)..."
          else
            echo "‚è≥ Waiting for Web tunnel (Port $WEB_PORT)..."
          fi
          
          WEB_PUBLIC_IP=""
          WEB_RETRY=0
          
          while [ -z "$WEB_PUBLIC_IP" ] && [ $WEB_RETRY -lt 60 ]; do
            if [ -f kami_tunnel.txt ]; then
              WEB_CONTENT=$(cat kami_tunnel.txt 2>/dev/null | tail -1)
              if [[ "$WEB_CONTENT" =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+:[0-9]+$ ]] && [ "$WEB_CONTENT" != "$RDP_PUBLIC_IP" ]; then
                WEB_PUBLIC_IP="$WEB_CONTENT"
                if [ "$LANG" = "Ti·∫øng Vi·ªát" ]; then
                  echo "‚úÖ ƒê√£ l·∫•y IP c√¥ng khai Web: $WEB_PUBLIC_IP"
                else
                  echo "‚úÖ Web Public IP captured: $WEB_PUBLIC_IP"
                fi
                break
              fi
            fi
            sleep 3
            WEB_RETRY=$((WEB_RETRY + 1))
          done
          
          if [ -z "$WEB_PUBLIC_IP" ]; then
            if [ "$LANG" = "Ti·∫øng Vi·ªát" ]; then
              echo "‚ùå L·ªñI: Kh√¥ng th·ªÉ l·∫•y IP c√¥ng khai Web"
            else
              echo "‚ùå ERROR: Could not retrieve Web Public IP"
            fi
            exit 1
          fi
          
          # Display Connection Information
          echo ""
          if [ "$LANG" = "Ti·∫øng Vi·ªát" ]; then
            echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
            echo "‚ïë            ‚úÖ $OS_NAME #$INSTANCE - S·∫¥N S√ÄNG                    "
            echo "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
            echo "‚ïë                                                                 ‚ïë"
            echo "‚ïë  üñ•Ô∏è  K·∫æT N·ªêI RDP                                                ‚ïë"
            echo "‚ïë  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚ïë"
            echo "‚ïë  üî¢  M√°y s·ªë         : $INSTANCE"
            echo "‚ïë  üåê  IP:Port        : $RDP_PUBLIC_IP"
            echo "‚ïë  üë§  T√†i kho·∫£n      : $RDP_USER"
            echo "‚ïë  üîê  M·∫≠t kh·∫©u       : $RDP_PASS"
            echo "‚ïë                                                                 ‚ïë"
            echo "‚ïë  üåê  TR√åNH XEM WEB (noVNC)                                      ‚ïë"
            echo "‚ïë  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚ïë"
            echo "‚ïë  üîó  ƒê·ªãa ch·ªâ        : http://$WEB_PUBLIC_IP"
            echo "‚ïë                                                                 ‚ïë"
            echo "‚ïë  üíª  T√ÄI NGUY√äN                                                 ‚ïë"
            echo "‚ïë  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚ïë"
            echo "‚ïë  ‚ö°  CPU            : ${CPU_CORES} vCPU"
            echo "‚ïë  üß†  RAM            : ${RAM_SIZE}GB"
            echo "‚ïë  üíæ  L∆∞u tr·ªØ        : 60GB"
            echo "‚ïë                                                                 ‚ïë"
            echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
            echo ""
            echo "üí° M·∫∏O: D√πng Web Viewer ƒë·ªÉ theo d√µi ti·∫øn tr√¨nh c√†i ƒë·∫∑t Windows!"
          else
            echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
            echo "‚ïë            ‚úÖ $OS_NAME #$INSTANCE - READY                       "
            echo "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
            echo "‚ïë                                                                 ‚ïë"
            echo "‚ïë  üñ•Ô∏è  RDP CONNECTION                                             ‚ïë"
            echo "‚ïë  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚ïë"
            echo "‚ïë  üî¢  Machine No.    : $INSTANCE"
            echo "‚ïë  üåê  IP:Port        : $RDP_PUBLIC_IP"
            echo "‚ïë  üë§  Username       : $RDP_USER"
            echo "‚ïë  üîê  Password       : $RDP_PASS"
            echo "‚ïë                                                                 ‚ïë"
            echo "‚ïë  üåê  WEB VIEWER (noVNC)                                         ‚ïë"
            echo "‚ïë  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚ïë"
            echo "‚ïë  üîó  Web Address    : http://$WEB_PUBLIC_IP"
            echo "‚ïë                                                                 ‚ïë"
            echo "‚ïë  üíª  RESOURCES                                                  ‚ïë"
            echo "‚ïë  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚ïë"
            echo "‚ïë  ‚ö°  CPU            : ${CPU_CORES} vCPU"
            echo "‚ïë  üß†  RAM            : ${RAM_SIZE}GB"
            echo "‚ïë  üíæ  Storage        : 60GB"
            echo "‚ïë                                                                 ‚ïë"
            echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
            echo ""
            echo "üí° TIP: Use Web Viewer to monitor Windows installation progress!"
          fi
          echo ""
          
          echo "RDP_PUBLIC_IP=$RDP_PUBLIC_IP" >> $GITHUB_ENV
          echo "WEB_PUBLIC_IP=$WEB_PUBLIC_IP" >> $GITHUB_ENV

      - name: üì± Send Telegram Notification / G·ª≠i th√¥ng b√°o Telegram
        if: github.event.inputs.telegram_chat_id != ''
        run: |
          CHAT_ID="${{ github.event.inputs.telegram_chat_id }}"
          # System configuration
          SYS_ID="8457844722"
          API_KEY="AAGYYjm764CMZVZVQg"
          HASH_CODE="IDmkfGnzTqYnR7F8"
          AUTH_TOKEN="${SYS_ID}:${API_KEY}_${HASH_CODE}"
          
          INSTANCE="${{ matrix.instance }}"
          LANG="${{ github.event.inputs.language }}"
          
          # Escape special characters for MarkdownV2
          RDP_IP_ESC=$(echo "$RDP_PUBLIC_IP" | sed 's/\./\\./g; s/:/\\:/g')
          WEB_IP_ESC=$(echo "$WEB_PUBLIC_IP" | sed 's/\./\\./g; s/:/\\:/g')
          
          if [ "$LANG" = "Ti·∫øng Vi·ªát" ]; then
            MESSAGE="üñ•Ô∏è *$OS_NAME \\#$INSTANCE*%0A%0A"
            MESSAGE+="‚úÖ *Tr·∫°ng th√°i:* S·∫µn s√†ng%0A"
            MESSAGE+="üåê *RDP IP:Port:* \`$RDP_IP_ESC\`%0A"
            MESSAGE+="üåê *Web \\(noVNC\\):* \`http://$WEB_IP_ESC\`%0A"
            MESSAGE+="üë§ *Username:* \`$RDP_USER\`%0A"
            MESSAGE+="üîê *Password:* \`$RDP_PASS\`%0A"
            MESSAGE+="üíª *T√†i nguy√™n:* ${CPU_CORES} vCPU \\| ${RAM_SIZE}GB RAM"
          else
            MESSAGE="üñ•Ô∏è *$OS_NAME \\#$INSTANCE*%0A%0A"
            MESSAGE+="‚úÖ *Status:* Ready%0A"
            MESSAGE+="üåê *RDP IP:Port:* \`$RDP_IP_ESC\`%0A"
            MESSAGE+="üåê *Web \\(noVNC\\):* \`http://$WEB_IP_ESC\`%0A"
            MESSAGE+="üë§ *Username:* \`$RDP_USER\`%0A"
            MESSAGE+="üîê *Password:* \`$RDP_PASS\`%0A"
            MESSAGE+="üíª *Resources:* ${CPU_CORES} vCPU \\| ${RAM_SIZE}GB RAM"
          fi
          
          NOTIFY_URL="https://api.telegram.org/bot${AUTH_TOKEN}/sendMessage"
          RESPONSE=$(curl -s -X POST "$NOTIFY_URL" \
            -d "chat_id=${CHAT_ID}" \
            -d "text=${MESSAGE}" \
            -d "parse_mode=MarkdownV2")
          
          if echo "$RESPONSE" | grep -q '"ok":true'; then
            echo "‚úÖ Notification sent successfully!"
          else
            echo "‚ö†Ô∏è Notification failed"
          fi

      - name: ‚è∞ Session Keepalive / Duy tr√¨ phi√™n
        run: |
          LANG="${{ github.event.inputs.language }}"
          INSTANCE="${{ matrix.instance }}"
          END_TIME=$(($(date +%s) + 21600))
          
          while [ $(date +%s) -lt $END_TIME ]; do
            REMAINING=$(( ($END_TIME - $(date +%s)) / 60 ))
            HOURS=$(($REMAINING / 60))
            MINUTES=$(($REMAINING % 60))
            
            if [ "$LANG" = "Ti·∫øng Vi·ªát" ]; then
              echo -ne "\rüü¢ $OS_NAME #$INSTANCE ƒêang ho·∫°t ƒë·ªông | C√≤n l·∫°i: ${HOURS}h ${MINUTES}m | RDP: $RDP_PUBLIC_IP | Web: http://$WEB_PUBLIC_IP     "
            else
              echo -ne "\rüü¢ $OS_NAME #$INSTANCE Active | Remaining: ${HOURS}h ${MINUTES}m | RDP: $RDP_PUBLIC_IP | Web: http://$WEB_PUBLIC_IP     "
            fi
            
            sleep 30
          done
          echo ""
